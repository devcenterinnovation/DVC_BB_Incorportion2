{
  "openapi": "3.0.3",
  "info": { "title": "Business API (Dev)", "version": "1.0.0-dev", "description": "Full specification including Dev/Debug endpoints" },
  "servers": [ { "url": "http://localhost:3000" } ],
  "tags": [ { "name": "Health" }, { "name": "Auth" }, { "name": "Customer" }, { "name": "Admin" }, { "name": "Business" }, { "name": "Dev/Debug" }, { "name": "Monitoring" } ],
  "components": {
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "JWT" },
      "apiKeyAuth": { "type": "apiKey", "in": "header", "name": "Authorization", "description": "Use 'Authorization: Token ck_...' for customer API key auth" }
    },
    "schemas": {
      "OkWrapper": { "type": "object", "properties": { "success": { "type": "boolean", "example": true }, "data": { "type": "object" } } },
      "ErrorResponse": { "type": "object", "properties": { "success": { "type": "boolean", "example": false }, "error": { "type": "object", "properties": { "code": { "type": "string" }, "message": { "type": "string" } }, "required": ["code", "message"] } }, "required": ["success", "error"] },
      "SignupRequest": { "type": "object", "properties": { "email": { "type": "string", "format": "email" }, "password": { "type": "string", "minLength": 8 }, "company": { "type": "string" }, "plan": { "type": "string", "enum": ["basic", "pro"] } }, "required": ["email", "password"] },
      "NameSearchRequest": { "type": "object", "properties": { "SearchType": { "type": "string", "example": "ALL" }, "searchTerm": { "type": "string", "example": "DANGOTE" }, "maxResults": { "type": "integer", "example": 3 } }, "required": ["SearchType", "searchTerm"] },
      "BusinessRegistrationRequest": { "type": "object", "properties": { "ref": { "type": "string" }, "full_name": { "type": "string" }, "business_name1": { "type": "string" }, "business_name2": { "type": "string" }, "nature_of_business": { "type": "string" }, "date_of_birth": { "type": "string" }, "email": { "type": "string", "format": "email" }, "phone": { "type": "string" }, "image_id_card": { "type": "string" }, "image_passport": { "type": "string" }, "image_signature": { "type": "string" } }, "required": ["ref","full_name","business_name1","business_name2","nature_of_business","email","phone","date_of_birth","image_id_card","image_passport","image_signature"] },
      "ApiKey": { "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "status": { "type": "string", "enum": ["active","revoked","suspended"] }, "createdAt": { "type": "string" } }, "required": ["id","name","status"] },
      "ApiKeyCreateResponse": { "type": "object", "properties": { "key": { "$ref": "#/components/schemas/ApiKey" }, "token": { "type": "string", "description": "Plaintext ck_ token (shown once)" } }, "required": ["token"] },
      "UsageResponse": { "type": "object", "additionalProperties": { "type": "integer" } },
      "AdminAuditItem": { "type": "object", "properties": { "id": { "type": "string" }, "endpoint": { "type": "string" }, "method": { "type": "string" }, "statusCode": { "type": "integer" }, "responseTimeMs": { "type": "integer" }, "timestamp": { "type": "string" } } }
    }
  },
  "paths": {
    "/health": { "get": { "tags": ["Health"], "summary": "Service health", "responses": { "200": { "description": "OK" } } } },
    "/api/v1/admin/auth/login": { "post": { "tags": ["Auth","Admin"], "summary": "Admin login (JWT)", "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "email": { "type": "string", "format": "email" }, "password": { "type": "string" } }, "required": ["email","password"] } } } }, "responses": { "200": { "description": "Logged in", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkWrapper" } } } }, "401": { "description": "Invalid credentials", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } },
    "/api/v1/customer/auth/signup": { "post": { "tags": ["Auth","Customer"], "summary": "Customer signup (JWT)", "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SignupRequest" } } } }, "responses": { "201": { "description": "Created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkWrapper" } } } }, "400": { "description": "Weak password / bad request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }, "409": { "description": "Email exists", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } },
    "/api/v1/customer/auth/login": { "post": { "tags": ["Auth","Customer"], "summary": "Customer login (JWT)", "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "email": { "type": "string", "format": "email" }, "password": { "type": "string" } }, "required": ["email","password"] } } } }, "responses": { "200": { "description": "Logged in", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkWrapper" } } } }, "401": { "description": "Invalid credentials", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } },
    "/api/v1/customer/me": { "get": { "tags": ["Customer"], "summary": "Get current customer profile", "security": [{"bearerAuth":[]}], "responses": { "200": { "description": "Profile", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkWrapper" } } } }, "401": { "description": "Unauthorized" } } } },
    "/api/v1/customer/api-keys": { "get": { "tags": ["Customer"], "summary": "List API keys", "security": [{"bearerAuth":[]}], "responses": { "200": { "description": "Keys" } } }, "post": { "tags": ["Customer"], "summary": "Create API key", "security": [{"bearerAuth":[]}], "requestBody": { "required": false, "content": { "application/json": { "schema": { "type": "object", "properties": { "name": { "type": "string" } } } } } }, "responses": { "200": { "description": "Created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ApiKeyCreateResponse" } } } }, "401": { "description": "Unauthorized" } } } },
    "/api/v1/customer/api-keys/{id}": { "delete": { "tags": ["Customer"], "summary": "Revoke API key", "security": [{"bearerAuth":[]}], "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } } ], "responses": { "200": { "description": "Revoked" }, "400": { "description": "Key not found" } } } },
    "/api/v1/customer/usage": { "get": { "tags": ["Customer"], "summary": "Get usage", "security": [{"bearerAuth":[]}], "responses": { "200": { "description": "Usage", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UsageResponse" } } } } } } },
    "/api/v1/name-search": { "post": { "tags": ["Business"], "summary": "Business name search / availability", "security": [{"bearerAuth":[]},{"apiKeyAuth":[]}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NameSearchRequest" } } } }, "responses": { "200": { "description": "Results", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkWrapper" } } } }, "400": { "description": "Invalid request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }, "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } },
    "/api/v1/name-similarity_removed": { "post": { "tags": ["Business"], "summary": "Business name similarity scoring", "security": [{"bearerAuth":[]},{"apiKeyAuth":[]}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NameSearchRequest" } } } }, "responses": { "200": { "description": "Results", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkWrapper" } } } }, "400": { "description": "Invalid request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }, "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } },
    "/api/v1/business/register": { "post": { "tags": ["Business"], "summary": "Submit business name registration", "security": [{"bearerAuth":[]},{"apiKeyAuth":[]}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BusinessRegistrationRequest" } } } }, "responses": { "201": { "description": "Registration submitted", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkWrapper" } } } }, "400": { "description": "Invalid request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }, "401": { "description": "Unauthorized", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } },
    "/api/v1/admin/audit/self": { "get": { "tags": ["Admin"], "summary": "View recent admin actions (audit)", "security": [{"bearerAuth":[]}], "parameters": [ { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 50 } } ], "responses": { "200": { "description": "Audit entries", "content": { "application/json": { "schema": { "type": "object", "properties": { "items": { "type": "array", "items": { "$ref": "#/components/schemas/AdminAuditItem" } } } } } } }, "401": { "description": "Unauthorized" } } } },
    "/api/v1/admin/dev/reset-password": { "post": { "tags": ["Dev/Debug"], "summary": "DEV ONLY: reset admin password from env", "responses": { "200": { "description": "Reset OK" }, "403": { "description": "Forbidden in prod" } } } },
    "/api/v1/admin/dev/seed": { "post": { "tags": ["Dev/Debug"], "summary": "DEV ONLY: seed admin email/password", "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "email": { "type": "string", "format": "email" }, "password": { "type": "string" } }, "required": ["email", "password"] } } } }, "responses": { "200": { "description": "Seeded" }, "403": { "description": "Forbidden in prod" } } } },
    "/api/v1/admin/debug/verify-token-detailed": { "post": { "tags": ["Dev/Debug"], "summary": "Verify a plaintext API key against DB", "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "token": { "type": "string" } }, "required": ["token"] } } } }, "responses": { "200": { "description": "Verification details" } } } },
    "/api/v1/admin/debug/import-plain-key": { "post": { "tags": ["Dev/Debug"], "summary": "Import a plaintext key from vault to DB", "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "plainKey": { "type": "string" } }, "required": ["plainKey"] } } } }, "responses": { "200": { "description": "Imported or already exists" }, "400": { "description": "Not found in vault" } } } },
    "/api/v1/admin/debug/plain-keys": { "get": { "tags": ["Dev/Debug"], "summary": "List recent masked plaintext keys from file vault", "parameters": [ { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 50 } } ], "responses": { "200": { "description": "Keys" } } } },
    "/api/v1/admin/debug/plain-keys-sqlite": { "get": { "tags": ["Dev/Debug"], "summary": "List recent masked keys from sqlite vault", "parameters": [ { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 50 } } ], "responses": { "200": { "description": "Keys" } } } }
  }
}
